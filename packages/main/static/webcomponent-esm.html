<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Auth Web Component Test</title>
    <link rel="stylesheet" href="./webcomponent-page.css">
</head>
<body>
    <header class="container config-section">
        <h1>Supabase Auth ESM Web Component Test Page</h1>
        <p>
            This page demonstrates dependency injection in a plain HTML page with the Supabase Auth web component.
            The component receives a pre-configured Supabase client via the <code>supabaseClient</code> property.
            This approach should make it possible to use the web component in any front-end framework with a bundler
            like Vite, sharing the same Supabase client instance used by the application. However, 
            it also works in a plain HTML page.
        </p>
    </header>

    <main class="container auth-container">
        <div class="auth-section">

            <supabase-auth
                id="basicAuth"
                initial-view="sign_in_with_password"
                providers='["google", "github"]'
                auth-options='{"auth":{"email":{"enable_signup":true},"mfa":{"required":false}}}'
            ></supabase-auth>

        </div>
    </main>

    <!-- Load import map (generated by build scripts: local for dev/CI, CDN for demo) -->
    <script type="importmap">
    { 
        "imports": {
            "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2", 
            "svelte-supabase-auth": "./webcomponent/supabase-auth-web-component.js"
        }
    }
    </script>

    <!-- Load the web component using ESM with import map alias 'ssa-wc' -->
    <script type="module">
        import { createClient } from '@supabase/supabase-js';
        import 'svelte-supabase-auth';

        // Create a shared Supabase client instance
        let supabaseClient = null;

        function initializeAuth() {

            const isFile = window.location.protocol === 'file:';
            const isLocalHost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            const useLocal = isFile || isLocalHost;
        
            const supabasePublicUrl = useLocal ? 'http://localhost:54321' : 'https://ruouzbfikpplqliwbswa.supabase.co';

            // Create a new client instance using the imported createClient
            supabaseClient = createClient(supabasePublicUrl, "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0");

            // Inject the client into the web component
            const basicAuth = document.getElementById('basicAuth');
            basicAuth.supabaseClient = supabaseClient;

            console.log('Supabase client injected into web component:', supabaseClient);
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', initializeAuth);
    </script>
</body>
</html>
